{% extends "admin/base_site.html" %}

{% load i18n %}

{% block stylesheet %}{% load adminmedia %}{% admin_media_prefix %}css/dashboard.css{% endblock %}

{% block bodyclass %}dashboard{% endblock %}

{% block breadcrumbs %}{% endblock %}

{% block title %}
	{% if all %}
	    {% trans "All missions" %}
	{% else %}
	    {% trans "Active missions" %}
	{% endif %}
{% endblock %}

{% block content %}

<div id="content-large">
{% if all %}
    <h1>{% trans "All missions" %}</h1>
{% else %}
    <h1>{% trans "Active missions" %}</h1>
{% endif %}

<table>
<tr><th>{% trans "Name" %}</th><th>{% trans "Mission id" %}</th><th>{% trans "Probability" %}</th><th></th></tr>
{% for mission in missions %}
	{% ifchanged mission.nature %}
	   <tr><th>{{ mission.get_nature_display }}</th></tr>
	{% endifchanged %}
	<tr {%cycle 'class="row1"' 'class="row2"' %} id="mission_{{ mission.id }}">
	    <td scope="row"><a href='{% url pydici.staffing.views.mission_staffing mission.id %}', title='{% blocktrans %}Defines {{ mission }} staffing{% endblocktrans %}'>{{ mission }}</a></td>
	    <td>{{ mission.mission_id }}</td>
	    <td>{{ mission.get_probability_display }} </td>
	    <td scope="row">
	       {% if mission.active %}
	           <a href="javascript:;"
	              onClick="$.get('{% url pydici.staffing.views.deactivate_mission mission.id %}',
	                               process_mission_archive)"
	              title='{% blocktrans %}Archive {{ mission }}{% endblocktrans %}'>
	              <em>{% trans "Archive" %}</em></a>
	       {% endif %}
	    </td>
	    <td scope="row"><a href='{% url admin:staffing_mission_change mission.id %}', title='{% blocktrans %}Change {{ mission }}{% endblocktrans %}', target='_blank', class='changelink'><em>{% trans "Change" %}</em></a></td>
	    <td>{% if mission.active %}
	           {% if mission.no_more_staffing_since %}
	               {% trans "This mission has no staffing in future" %}
	           {% else %}
		           {% if mission.no_staffing_update_since %}
	                   {% trans "Staffing has not been updated recently" %}
	               {% endif %}
               {% endif %}
            {% endif %}
	    </td>
	</tr>
{% endfor %}
</table>

<br><br>
{% if all %}
    <a href='{% url missions %}'>{% trans "Only display active missions" %}</a>
{% else %}
    <a href='{% url all-missions %}'>{% trans "Display all missions" %}</a>
{% endif %}
&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;
<a href='{% url admin:staffing_mission_changelist %}'>{% trans "Missions administration" %}</a>
&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;
<a href='{% url index %}'>{% trans "Back to home page" %}</a>
</div>

<script type="text/JavaScript">
<!--
    // Function that process ajax callback
    function process_mission_archive(data) {
        if (data.error==true) {
            alert("{% trans 'Archiving failed' %}");
        }
        else {
            $("#mission_" + data.id).hide("fast");
        }
    };
-->
</script>

{% endblock %}