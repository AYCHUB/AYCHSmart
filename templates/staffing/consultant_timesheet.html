{% extends "staffing/consultant_base.html" %}
{% load i18n %}
{% load pydici_filters %}


{% block mobile-page-header %}
<h1>{% trans "Timesheet" %} {{ month|date:"F Y"}} {% trans "Week " %} {{ week }}</h1>
<div data-role="navbar">
    <ul>
       <li><a href='{% url pydici.staffing.views.consultant_timesheet consultant_id=consultant.id, year=previous_date|date:"Y",month=previous_date|date:"m", week=previous_week %}' data-direction="reverse">{% trans 'Previous week' %}</a></li>
       <li><a href='{% url pydici.staffing.views.consultant_timesheet consultant_id=consultant.id, year=next_date|date:"Y",month=next_date|date:"m", week=next_week %}'>{% trans 'Next week' %}</a></li>
    </ul>
</div><!-- /navbar -->
{% endblock %}


{% block consultant_detail %}

{% if not request.session.mobile %}
    <h2>
    {% if week %}
        <a href='{% url pydici.staffing.views.consultant_timesheet consultant_id=consultant.id, year=previous_date|date:"Y",month=previous_date|date:"m", week=previous_week %}' title="{% trans 'Previous week' %}"><img src="{{ MEDIA_URL }}pydici/fg.png" border=0/></a>
    {% else %}
        <a href='{% url pydici.staffing.views.consultant_timesheet consultant_id=consultant.id, year=previous_date|date:"Y",month=previous_date|date:"m" %}' title="{% trans 'Previous month' %}"><img src="{{ MEDIA_URL }}pydici/fg.png" border=0/></a>
    {% endif %}
    {% trans "Timesheet" %} {{ month|date:"F Y"}}
    {% if week %}
        {% trans "Week " %} {{ week }}
        <a href='{% url pydici.staffing.views.consultant_timesheet consultant_id=consultant.id, year=next_date|date:"Y",month=next_date|date:"m", week=next_week %}' title="{% trans 'Next week' %}"><img src="{{ MEDIA_URL }}pydici/fd.png" border=0/></a>
    {% else %}
        <a href='{% url pydici.staffing.views.consultant_timesheet consultant_id=consultant.id, year=next_date|date:"Y",month=next_date|date:"m" %}' title="{% trans 'Next month' %}"><img src="{{ MEDIA_URL }}pydici/fd.png" border=0/></a>
    {% endif %}
    </h2>

    <a href="{% url pydici.staffing.views.consultant_staffing consultant.id %}" class='changelink'>{% trans "See also forecast staffing of this consultant" %}</a>
    <br/><br/>
{% endif %}

    {% if week %}
        <form action='{% url pydici.staffing.views.consultant_timesheet consultant_id=consultant.id, year=month|date:"Y",month=month|date:"m",week=week %}' method="POST">
    {% else %}
        <form action='{% url pydici.staffing.views.consultant_timesheet consultant_id=consultant.id, year=month|date:"Y",month=month|date:"m" %}' method="POST">
    {% endif %}
    <table class='small-form-row' style="text-align:center">
            <tr>
            {% for day in days %}
                <td></td><td>{{ day|date:"j" }}</td>
            {% endfor %}
            <td></td><td></td></tr>
            <tr>
            {% for day in days %}
                <td></td><td>{{ day|date:"D" }}</td>
            {% endfor %}
            <td>{% trans "Tot." %}</td><td>{% trans "Forec." %}</td></tr>
            <tr>
            {% for field in form  %}
                {% if field.is_hidden %}
	               <td style="font-weight:bold;">{{ field.label|split:" "|first|floatformat:-2 }}</td>
	               <td>{{ field.label|split:" "|last|floatformat:-2 }}</td>
	               </tr><tr>
                {% else %}
	               <td style="text-align:left">{{ field.label }}{{ field.errors }}</td>
	               <td>{{ field }}</td>
                {% endif %}
            {% endfor %}
            </tr>
            <tr>
            {% for i in warning %}
                <td></td><td>
                {% ifequal i 0 %}<img src="{{ MEDIA_URL }}/img/admin/icon_success.gif"/>{% endifequal %}
                {% ifequal i 1 %}<img src="{{ MEDIA_URL }}/img/admin/icon_alert.gif"/>  {% endifequal %}
                {% ifequal i 2 %}<img src="{{ MEDIA_URL }}/img/admin/icon-no.gif"/>  {% endifequal %}
                </td>
            {% endfor %}
            </tr>
    </table>
    <br/>
    {% if read_only %}
        <em>{% trans "Note: Past month timesheet are read only" %}</em>
    {% else %}
        <div class="submit-row">
            <input type="submit" value="{% trans 'Save' %}"/>
        </div>
    {% endif %}
    </form>
    <br/><p>{% trans "Working days in this month: " %} {{ working_days }}</p>
    {% if working_days_balance %}
    <p>{% trans "Working days balance: " %} {{ working_days_balance|floatformat:-2 }}</p>
    {% endif %}
    {% if not request.session.mobile %}<a href="{% url pydici.staffing.views.consultant_timesheet consultant_id=consultant.id, year=month.year, month=month.month %}/?csv">{% trans "Export this timesheet in a spreadsheet" %}</a>{% endif %}

<SCRIPT type="text/JavaScript">

$(document).ready(function()
{
	$("input[name^='charge_']").click(function()
	    {
	        if ($(this).val() == 0) { i="½"; }
	        else if ($(this).val() == "½") { i=1; }
	        else if ($(this).val() == 1)   { i="¼"; }
	        else if ($(this).val() == "¼")   { i="¾"; }
	        else if ($(this).val() == "¾")   { i=0; }
	        $(this).val(i);
	        $(this).css("background", "rgba(255,0,0,0.3)");
	        $(".submit-row input").css("background", "rgba(255,0,0,0.2)");
	    });
})
</SCRIPT>
{% endblock %}
