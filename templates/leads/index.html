{% extends "admin/base_site.html" %}
{% load i18n %}
{% load pydici_filters %}

{% block stylesheet %}{% load adminmedia %}{% admin_media_prefix %}css/dashboard.css{% endblock %}

{% block bodyclass %}dashboard{% endblock %}

{% block breadcrumbs %}{% endblock %}

{% block content %}
<div id="content-main">
    {% if my_leads_as_responsible %}
    <div class="imodule">
        <table summary="Leads">
        <tr><th colspan=6>Les leads dont je suis responsable</th></tr>
        <tr>
                <td><b>Lead</b></td>
                <td><b>Responsable</b></td>
                <td><b>IA</b></td>
                <td><b>CA (k€)</b></td>
                <td><b>Statut</b></td>
                <td><b>Mise à jour</b></td>
        </tr>

        {% for lead in my_leads_as_responsible %}
            <tr {%cycle 'class="row1"' 'class="row2"' %}>
                <td><b><a href='/leads/{{lead.id}}/', title='{{ lead.description }}'>{{ lead.client.organisation }} - {{ lead.name|truncate_by_chars:"50" }}</a></b></td>
                <td>{{ lead.responsible }}</td>
                <td>{{ lead.salesman.name }}</td>
                <td>{{ lead.sales }}</td>
                <td>{{ lead.get_state_display }}</td>
                <td>{{ lead.update_date_strf }}</td>
            </tr>
        {% endfor %}

    {% endif %}
    {% if my_leads_as_staffee %}
        <tr><th colspan=6>Les leads où je suis une ressource pressentie</th></tr>
        <tr>
                <td><b>Lead</b></td>
                <td><b>Responsable</b></td>
                <td><b>IA</b></td>
                <td><b>CA (k€)</b></td>
                <td><b>Statut</b></td>
                <td><b>Mise à jour</b></td>
        </tr>

        {% for lead in my_leads_as_staffee %}
            <tr {%cycle 'class="row1"' 'class="row2"' %}>
                <td><b><a href='/leads/{{lead.id}}/', title='{{ lead.description }}'>{{ lead.client.organisation }} - {{ lead.name|truncate_by_chars:"50" }}</a></b></td>
                 <td>{{ lead.responsible }}</td>
                <td>{{ lead.salesman.name }}</td>
                <td>{{ lead.sales }}</td>
                <td>{{ lead.get_state_display }}</td>
                <td>{{ lead.update_date_strf }}</td>
            </tr>
        {% endfor %}
    {% endif %}
    {% if latest_leads %}
        <tr><th colspan=6>Les derniers leads modifiés</th></tr>
        <tr>
                <td><b>Lead</b></td>
                <td><b>Responsable</b></td>
                <td><b>IA</b></td>
                <td><b>CA (k€)</b></td>
                <td><b>Statut</b></td>
                <td><b>Mise à jour</b></td>
        </tr>

        {% for lead in latest_leads %}
            <tr {%cycle 'class="row1"' 'class="row2"' %}>
                <td><b><a href='/leads/{{lead.id}}/', title='{{ lead.description }}'>{{ lead.client.organisation }} - {{ lead.name|truncate_by_chars:"50" }}</a></b></td>
                <td>{{ lead.responsible }}</td>
                <td>{{ lead.salesman.name }}</td>
                <td>{{ lead.sales }}</td>
                <td>{{ lead.get_state_display }}</td>
                <td>{{ lead.update_date_strf }}</td>
            </tr>
        {% endfor %}
    {% endif %}
    {% if my_latest_archived_leads %}
        <tr><th colspan=6>Mes derniers leads archivés (gagnés, perdus ou abandonnés)</th></tr>
        <tr>
                <td><b>Lead</b></td>
                <td><b>Responsable</b></td>
                <td><b>IA</b></td>
                <td><b>CA (k€)</b></td>
                <td><b>Statut</b></td>
                <td><b>Mise à jour</b></td>
        </tr>

        {% for lead in my_latest_archived_leads %}
            <tr {%cycle 'class="row1"' 'class="row2"' %}>
                <td><b><a href='/leads/{{lead.id}}/', title='{{ lead.description }}'>{{ lead.client.organisation }} - {{ lead.name|truncate_by_chars:"50" }}</a></b></td>
                <td>{{ lead.responsible }}</td>
                <td>{{ lead.salesman.name }}</td>
                <td>{{ lead.sales }}</td>
                <td>{{ lead.get_state_display }}</td>
                <td>{{ lead.update_date_strf }}</td>
            </tr>
        {% endfor %}
    {% endif %}
        <tr><th colspan=6>Récapitulatifs</th></tr>
        <tr><td><a href='/leads/review'>Revue des affaires en cours</a></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td><a href='/leads/csv/active'>Fichier CSV des leads actifs</a></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td><a href='/leads/csv/all'>Fichier CSV de tous les leads</a></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td><a href='/leads/mail/html'>Mail récapitulatif (format HTML)</a></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td><a href='/leads/mail/text'>Mail récapitulatif (format texte)</a></td><td></td><td></td><td></td><td></td><td></td></tr>
        </table>
    </div>
</div>
{% endblock %}


{% block sidebar %}
<div id="content-related">
    <div class="module" id="recent-actions-module">
        <h2></h2>
        <h3>Rechercher un lead</h3>
        <div id="toolbar"><form id="changelist-search" action="admin/leads/lead/" method="get">
		<div><!-- DIV needed for valid HTML -->
		<label for="searchbar"><img src="{% admin_media_prefix %}img/admin/icon_searchbox.png" alt="Search" /></label>
		<input type="text" size="20" name="q" value="{{ cl.query|escape }}" id="searchbar" />
		<input type="submit" value="{% trans 'Go' %}" />
		</div>
		</form></div>
		<script type="text/javascript">document.getElementById("searchbar").focus();</script>
		<br/>
		<h3>Ajouter...</h3>
		    <ul class="actionlist">
		    <li><a href='/leads/admin/leads/lead/add/'>un nouveau lead</a></li>
		    <li><a href='/leads/admin/leads/client/add/'>un nouveau client</a></li>
		    <li><a href='/leads/admin/leads/clientcontact/add/'>un nouveau contact client</a></li>
		    </ul>
		 <br/>
        <h3>Mes dernières actions</h3>
            {% load log %}
            {% get_admin_log 10 as admin_log for_user user %}
            {% if not admin_log %}
            <p>{% trans 'None available' %}</p>
            {% else %}
            <ul class="actionlist">
            {% for entry in admin_log %}
            <li class="{% if entry.is_addition %}addlink{% endif %}{% if entry.is_change %}changelink{% endif %}{% if entry.is_deletion %}deletelink{% endif %}">{% if not entry.is_deletion %}<a href="/leads/admin/{{ entry.content_type.app_label }}/{{ entry.content_type.model }}/{{ entry.object_id }}/">{% endif %}{{ entry.object_repr|escape }}{% if not entry.is_deletion %}</a>{% endif %}<br /><span class="mini quiet">{% filter capfirst %}{% trans entry.content_type.name %}{% endfilter %}</span></li>
            {% endfor %}
            </ul>
            {% endif %}
        <br/>
        <h3><a href="/leads/admin/">Console d'administration</a></h3>
        <ul class="actionlist">
	        <li><a href="/leads/admin/leads/lead/">Tous les leads</a></li>
	        <li><a href="/leads/admin/leads/mission/">Toutes les missions</a></li>
	        <li><a href="/leads/admin/leads/client/">Tous les clients</a></li>
	        <li><a href="/leads/admin/leads/clientcontact/">Tous les contacts clients</a></li>
        </ul>
    </div>
</div>
{% endblock %}
